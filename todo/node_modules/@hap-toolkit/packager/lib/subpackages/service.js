"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createPackagesDefinition=createPackagesDefinition,exports.allocateResourceToPackages=allocateResourceToPackages;var _fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),_compilationConfig=require("@hap-toolkit/shared-utils/compilation-config"),_utils=require("../common/utils"),_package=require("./package");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const MAIN_PKG_NAME=_compilationConfig.compileOptionsMeta.MAIN_PKG_NAME,SPLIT_CHUNKS_PAGE_NAME=_compilationConfig.compileOptionsMeta.splitChunksNameEnum.PAGE;function createPackagesDefinition(e,t,a,o){const i=(0,_package.createFullPackage)(e);let c;return t&&t.length>0&&(c=(0,_package.createSubPackages)(e,t,a)),i.comment=o,(c||[]).forEach(e=>{e.comment=o}),{fullPackage:i,subPackages:c}}function allocateResourceToPackages(e,t,a,o){const i=new RegExp(`^${SPLIT_CHUNKS_PAGE_NAME}$`),c=new RegExp(`\\/${SPLIT_CHUNKS_PAGE_NAME}$`),n=_path.default.join(MAIN_PKG_NAME,SPLIT_CHUNKS_PAGE_NAME);e.forEach(e=>{const r=_path.default.join(t,e),s=_fs.default.readFileSync(r),u=[e,s,(0,_utils.calcDataDigest)(s)];if(c.test(e)||a.addResource(...u),!o||i.test(e))return;let l=!0;e===n&&(u[0]=SPLIT_CHUNKS_PAGE_NAME);for(let t=1;t<o.length;t++){const a=o[t];if(a.standalone&&("manifest.json"===e||"sitemap.json"===e||e.startsWith("i18n")||a.icon&&a.icon.indexOf(e)>0)&&a.addResource(...u),a.subMatch.test(e)){l=!1,a.addResource(...u);break}}if(l){o[0].addResource(...u)}}),o&&o.forEach(e=>{if(!e.resourceList.length)throw new Error(`分包失败：分包${e.fileName}内不包含任何资源，请重新检查manifest`)})}
//# sourceMappingURL=service.js.map
