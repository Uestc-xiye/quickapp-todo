"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buildProjectAndOutput=buildProjectAndOutput,Object.defineProperty(exports,"createPackagesDefinition",{enumerable:!0,get:function(){return _index2.createPackagesDefinition}}),Object.defineProperty(exports,"allocateResourceToPackages",{enumerable:!0,get:function(){return _index2.allocateResourceToPackages}}),Object.defineProperty(exports,"createZipBufferForPackage",{enumerable:!0,get:function(){return _index2.createZipBufferForPackage}});var _sharedUtils=require("@hap-toolkit/shared-utils"),_constant=require("../common/constant"),_ziputil=require("../common/ziputil"),_index=require("../signature/index"),_index2=require("../subpackages/index");function validateRpkOrSrpkFile(e,t){let r=0;e.forEach((e,a)=>{const i=`${t[a].fileName}`,o=e.length;r+=o,_sharedUtils.colorconsole.log(`### App Loader ### '${i}' 大小为 ${Math.ceil(o/1024)} KB`),o>_constant.SINGLE_PKG_SIZE&&_sharedUtils.colorconsole.warn(`### App Loader ### 每个分包大小不能大于 ${_constant.SINGLE_PKG_SIZE/1024} KB, '${i}' 已超出`)}),r>_constant.FULL_PKG_SIZE&&_sharedUtils.colorconsole.warn(`### App Loader ### 所有分包总和大小不能大于 ${_constant.FULL_PKG_SIZE/1024} KB, 已超出`)}async function buildProjectAndOutput(e,t,r,a){let i=await(0,_index2.createZipBufferForPackage)(e),o=await Promise.all((t||[]).map(e=>(0,_index2.createZipBufferForPackage)(e)));if(a&&(i=await(0,_ziputil.removeMetaForRpkOrRpksFile)(i),o=await Promise.all(o.map(_ziputil.removeMetaForRpkOrRpksFile))),r){const{privatekey:e,certificate:t}=r;i=await(0,_index.signZipBufferForPackage)(i,e,t),o=await Promise.all(o.map(r=>(0,_index.signZipBufferForPackage)(r,e,t)))}validateRpkOrSrpkFile(o,t);let n=null;if(o.length){const a=[];if(a.push({path:e.fileName,content:i}),o.forEach((e,r)=>{const i=t[r].fileName;a.push({path:i,content:e})}),n=await(0,_ziputil.createZipBufferFromFileList)(a,e.comment),r){const{privatekey:e,certificate:t}=r;n=await(0,_index.signZipBufferForPackage)(n,e,t)}}return{rpkBuffer:i,rpksBuffer:n}}
//# sourceMappingURL=index.js.map
