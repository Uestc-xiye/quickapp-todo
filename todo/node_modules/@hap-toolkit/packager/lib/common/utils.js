"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isEmptyObject=isEmptyObject,exports.getFilenameByPath=getFilenameByPath,exports.serialize=serialize,exports.sortFilesBy=sortFilesBy,exports.lsdirdeep=lsdirdeep,exports.loaderWrapper=loaderWrapper,exports.isPlainObject=isPlainObject,exports.calcDataDigest=calcDataDigest,exports.genPriorities=genPriorities,exports.mergeDeep=mergeDeep,exports.FRAG_TYPE=exports.ENTRY_TYPE=void 0;var _fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),_crypto=_interopRequireDefault(require("crypto")),_sharedUtils=require("@hap-toolkit/shared-utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function isEmptyObject(e){if(!e)return!0;for(const t in e)return!1;return!0}function getFilenameByPath(e){return _path.default.relative(".",e)}function serialize(e,t){const r=typeof e;if("undefined"===r)return e;if("function"===r)return e.toString();const i=[];let n=-1,o=`__FKS_${Math.random().toString(16).slice(2,10)}_FKE__`;const s=JSON.stringify(e,(e,t)=>"function"==typeof t?"":t);for(;s.indexOf(o)>-1;)o=`_${o}_`;let a=JSON.stringify(e,(function(e,t){return"function"==typeof t?(i.push(t),n++,o+n):t}),t);const p=new RegExp(`"${o}(\\d+)"`,"g");return a=a.replace(p,(e,t)=>i[t].toString()),a}function predicate(e){return"string"==typeof e?e===this.toString():this.match(e)}function sortFilesBy(e,t){const r=e.length;return e=e.sort((e,i)=>{let n=t.findIndex(predicate,e),o=t.findIndex(predicate,i);return n=-1===n?r:n,o=-1===o?r:o,n-o})}function lsdirdeep(e,t=_fs.default){return function e(t,r,i){let n=[];const o=_path.default.posix.join(t,r);return i.readdirSync(o).forEach(s=>{const a=_path.default.posix.join(o,s),p=_path.default.posix.join(r,s);i.statSync(a).isFile()?n.push(p):n=n.concat(e(t,p,i))}),n}(e,".",t)}function loaderWrapper(e,t){Array.isArray(t.use)||(t.use=[t.use]),t.use.unshift({loader:require.resolve("../loaders/module-loader")}),t.use.push({loader:require.resolve("../loaders/manifest-loader"),options:{path:e}})}const toString=Object.prototype.toString,OBJECT_STRING="[object Object]";function isPlainObject(e){return toString.call(e)===OBJECT_STRING}const ENTRY_TYPE={APP:"app",PAGE:"page",COMP:"comp",CARD:"card",JS:"js"};exports.ENTRY_TYPE=ENTRY_TYPE;const FRAG_TYPE={IMPORT:"import",TEMPLATE:"template",STYLE:"style",SCRIPT:"script"};function calcDataDigest(e){const t=_crypto.default.createHash("SHA256");return t.update(e),t.digest()}function genPriorities(e){const t=[/^i18n\/.+\.json$/i,"manifest.json","app.js",/page-chunks.json$/,/^common\//i];if(e&&e.router&&e.router.entry){const r=e.router.entry;t.splice(4,0,new RegExp(`^${r}/$`),new RegExp(`^${r}/.+`))}else _sharedUtils.colorconsole.error("manifest.json 中未配置入口页面 router.entry");return t}function mergeDeep(e,...t){if(!t.length)return e;const r=t.shift();if(isPlainObject(e)&&isPlainObject(r))for(const t in r)isPlainObject(r[t])?(e[t]||Object.assign(e,{[t]:{}}),mergeDeep(e[t],r[t])):Object.assign(e,{[t]:r[t]});return mergeDeep(e,...t)}exports.FRAG_TYPE=FRAG_TYPE;
//# sourceMappingURL=utils.js.map
