"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.signZipBufferForPackage=signZipBufferForPackage,exports.builtinSignFolder=void 0;var _path=_interopRequireDefault(require("path")),_utils=require("../common/utils"),_constant=require("../common/constant"),_ziputil=require("../common/ziputil"),_index=require("./algorithm/index");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}const builtinSignFolder=_path.default.join(__dirname,"pem");function fileFilter(t){const e=t.path;return!e.endsWith("/")&&e!==_constant.DIGEST_ZIP_PATH}async function signZipBufferForPackage(t,e,i){const n=await(0,_ziputil.createFileListFromZipBuffer)(t),a=[],r=[],o=n.getFileBuffer(_constant.DIGEST_ZIP_PATH);if(o){const t={name:_constant.DIGEST_HASH_JSON,hash:(0,_utils.calcDataDigest)(o)},n=await(0,_index.doSign)(o,[t],e,i);r.push({path:_constant.DIGEST_ZIP_PATH,content:n}),a.push({name:_constant.DIGEST_ZIP_PATH,hash:(0,_utils.calcDataDigest)(n)})}n.fileList.filter(fileFilter).map(t=>{r.push(t),a.push({name:t.path,hash:(0,_utils.calcDataDigest)(t.content)})});const u=await(0,_ziputil.createZipBufferFromFileList)(r,n.comment);return await(0,_index.doSign)(u,a,e,i)}exports.builtinSignFolder=builtinSignFolder;
//# sourceMappingURL=index.js.map
