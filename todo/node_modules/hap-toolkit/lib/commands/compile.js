"use strict";const webpack=require("webpack"),{setCustomConfig:setCustomConfig,colorconsole:colorconsole}=require("@hap-toolkit/shared-utils"),genWebpackConf=require("../../gen-webpack-conf"),{summaryErrors:summaryErrors}=require("./utils");let watching=null;function showVersion(){const o=require("../../package.json").version,r=require("@babel/core/package.json").version,e=require("webpack/package.json").version;colorconsole.info(`hap-toolkit: ${o}; babel: ${r}; webpack: ${e};`)}showVersion(),module.exports.compile=function(o,r,e,s={}){return new Promise((n,c)=>{function t(o,r){if(o&&(colorconsole.error(o),s.onerror(o)),r){if(r.hasErrors()||r.hasWarnings()){const o=summaryErrors(r);console.error(o)}r.hasErrors()&&(process.exitCode=1)}}colorconsole.attach(s.log),setCustomConfig(s.cwd),process.env.NODE_PLATFORM=o,process.env.NODE_PHASE=r;const a="prod"===r?"production":"development";try{const o=genWebpackConf(s,a);if(e){const r=webpack(o);watching=r.watch({aggregateTimeout:300},(o,r)=>{t(o,r),n({compileError:o,stats:r,watching:watching})})}else webpack(o,(o,r)=>{t(o,r),n({compileError:o,stats:r})})}catch(o){c(o)}})},module.exports.stopWatch=function(){return new Promise(o=>{watching?watching.close(()=>{watching=null,o({stopWatchError:null})}):o({stopWatchError:"no watching"})})};
//# sourceMappingURL=compile.js.map
