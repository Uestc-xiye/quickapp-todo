"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.resign=resign;var _path=_interopRequireDefault(require("path")),_fsExtra=_interopRequireDefault(require("fs-extra")),_glob=_interopRequireDefault(require("glob")),_index=require("@hap-toolkit/packager/lib/index"),_sharedUtils=require("@hap-toolkit/shared-utils"),_config=require("@hap-toolkit/shared-utils/config");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}async function resign(e={}){const t=_path.default.resolve(_config.projectPath,e.dest);_fsExtra.default.emptyDirSync(t);const a=_fsExtra.default.readFileSync(_path.default.resolve(_config.projectPath,e.sign,"private.pem")),r=_fsExtra.default.readFileSync(_path.default.resolve(_config.projectPath,e.sign,"certificate.pem"));let i=[];if(e.file){const t=_path.default.resolve(process.cwd(),e.file);i=[_path.default.basename(t)]}else i=_glob.default.sync("**/*.{rpks,rpk}",{cwd:_path.default.resolve(_config.projectPath,e.origin)});const l=_path.default.resolve(_config.projectPath,e.dest),s=_path.default.resolve(_config.projectPath,e.origin),o=i.map(async e=>{let t=_fsExtra.default.readFileSync(_path.default.resolve(s,e));e.endsWith(".rpk")&&(t=await(0,_index.signForRpk)(t,a,r)),e.endsWith(".rpks")&&(t=await(0,_index.signForRpks)(t,a,r)),generateDistFile(t,l,e)});await Promise.all(o)}function generateDistFile(e,t,a){const r=_path.default.resolve(t,a);_fsExtra.default.writeFileSync(r,e);const i=_path.default.extname(a);_sharedUtils.colorconsole.log(`### App Loader ### ${(0,_sharedUtils.relateCwd)(t)} 目录签名并生成${i}文件：${a}`)}
//# sourceMappingURL=resign.js.map
