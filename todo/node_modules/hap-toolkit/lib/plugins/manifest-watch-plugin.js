"use strict";const path=require("path"),{colorconsole:colorconsole,readJson:readJson}=require("@hap-toolkit/shared-utils"),{resolveEntries:resolveEntries}=require("../utils");function sort(t){return t.sort((t,s)=>t.localeCompare(s))}module.exports=class{constructor(t){this.appRoot=t.appRoot,this.root=t.root,this.manifestFile=path.resolve(this.root,"manifest.json");let s={};try{const t=readJson(this.manifestFile);s=resolveEntries(t,this.root,this.appRoot)}catch(t){}this.list=Object.keys(s),this.list=sort(this.list)}hasChanged(t){const s=sort(t),o=JSON.stringify(s)!==JSON.stringify(this.list);return o&&(this.list=s),o}apply(t){t.hooks.watchRun.tapAsync("watch",(t,s)=>{try{if(t.watchFileSystem.watcher.mtimes[this.manifestFile]){const s=readJson(this.manifestFile),o=resolveEntries(s,this.root,this.appRoot),e=Object.keys(o);this.hasChanged(e)&&(this.list=e,t.hooks.entryOption.call(this.appRoot,o))}}catch(t){colorconsole.error(t.message)}s()})}};
//# sourceMappingURL=manifest-watch-plugin.js.map
